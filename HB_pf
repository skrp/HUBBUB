########################
# HB_pf - packet fileter
# NET ##################
int = ""
gate = ""
int_broker = ""
self = ""
ftpproxy="127.0.0.1"
ftp_prox_port="8021"
scplog_port="8666"

# OPTIONS 
set skip on lo0
set block-policy drop
scrub on $int all reassemble tcp

# ROUTE
rdr pass proto tcp from any to $ext_broker port ftp -> $ftpproxy port $ftp_prox_port

# ANCHOR
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
anchor "ftp-proxy/*"

# FILTER ###############
block log all
# VPN
pass out on $int inet proto udp from $self to $int_broker port vpn
# DNS 
pass on $int inet proto tcp from $self to $int_broker port ntp
# SSH
pass on $int inet proto tcp from <node> to $self port ssh
pass on $int inet proto tcp from $self to <node> port ssh
pass on $int inet proto tcp from <node> to $int_broker port $scplog_port
# FTP
pass on $int inet proto tcp from $ext_broker to $ftp_server port $ftp_prox_port
# PING
pass on $int inet proto icmp from <node> to <node> icmp-type echoreq
# NFS
pass on $int inet proto { tcp, udp } from $self to <node> port nfs
pass on $int inet proto { tcp, udp } from <node> to $self port nfs
